;
; Project1-1.asm
;
; Created: 3/24/2019 6:06:13 PM
; Author : warho
;


; Replace with your application code



.org 0

	LDI R26, HIGH(RAMEND)
	OUT SPH, R26
	LDI R26, LOW(RAMEND)
	OUT SPL, R26
    LDI R16, 0xFF
	OUT DDRC, R16
	OUT DDRD, R16
	OUT DDRE, R16
	SBI PORTE, 5
	OUT PORTD, R16
	CBI DDRA, 0
	SBI PORTA, 0
	CBI PINA, 0
	CBI DDRA, 1
	SBI PORTA, 1
	CBI PINA, 1
	CBI DDRA, 2
	SBI PORTA, 2
	CBI PINA, 2
	CBI DDRA, 3
	SBI PORTA, 3
	CBI PINA, 3
	CBI DDRA, 4
	SBI PORTA, 4
	CBI PINA, 4
	CBI DDRA, 5
	SBI PORTA, 5
	CBI PINA, 5
	CBI DDRA, 6
	SBI PORTA, 6
	CBI PINA, 6

	LDI R20, 0x00
	LDI R21, 0x00
	LDI R22, 0x00
	LDI R27, 0x00
	LDI R28, 0x00
	LDI R31, 0x00

START:
	OUT PORTD, R16
	SBI PORTE, 5
	SBIS PINA, 0
	RJMP INCREMENT_PRESS
	SBIS PINA, 1
	RJMP DECREMENT_PRESS
	SBIS PINA, 2
	RCALL BUZZ
	SBIS PINA, 3
	RJMP SPIN_WHEEL_PRESS
	SBIS PINA, 4
	RJMP PLAY_A_SONG
	SBIS PINA, 5
	RJMP MINICOUNT
	SBIS PINA,6
	RJMP STOPWATCH_PRESS
	RJMP START

INCREMENT_PRESS:
	SBIC PINA, 0
	RJMP INCREMENT
	RJMP INCREMENT_PRESS

INCREMENT:
	INC R20
	CPI R20, 16
	BRMI NO_UPPER_LOOP
	RCALL BUZZ
	LDI R20, 0
NO_UPPER_LOOP:
	COM R20
	OUT PORTD, R20
	COM R20
	RCALL DELAY3
	COM R31
	OUT PORTD, R31
	COM R31
	RJMP START

MINICOUNT:
	LDI R29, 0x0A
	LDI R30, 0x00
LOOPX:
	CALL SEVSEG
	LDI R27, 0x00
	INC R30
	DEC R29
	BREQ START
	RJMP LOOPX 


DECREMENT_PRESS:
	SBIC PINA, 1
	RJMP DECREMENT
	RJMP DECREMENT_PRESS

DECREMENT:
	DEC R20
	BRPL NO_LOWER_LOOP
	RCALL BUZZ
	LDI R20, 15
NO_LOWER_LOOP:
	COM R20
	OUT PORTD, R20
	COM R20
	RCALL DELAY3
	COM R31
	OUT PORTD, R31
	COM R31
	RJMP START

BUZZ:
	LDI R23, 0xFF
LOOPB:
	SBI PORTE, 4
	RCALL DELAY1
	NOP
	NOP
	CBI PORTE, 4
	RCALL DELAY1
	SBIC PINA, 2
	DEC R23
	BRNE LOOPB
	RET

STOPWATCH:
	LDI R17, 0
LOOPS1:
	CALL TIMERDELAY
	INC R17
	SBIS PINA, 6
	RJMP DISPLAY
	CPI R17, 60
	BRSH MINUTE
	RJMP LOOPS1

MINUTE:
	RCALL BUZZ
	LDI R17, 0
	RJMP LOOPS1

DISPLAY:
	COM R17
	OUT PORTD, R17
	COM R17
	RCALL DELAY3
	RJMP START

SPIN_WHEEL_PRESS:
    COM R16
	OUT PORTD, R16
	COM R16
	LDI R22, 0x01
	SBIC PINA, 3
	RJMP SPIN_WHEEL
	INC R21
	RJMP SPIN_WHEEL_PRESS

SPIN_WHEEL:
	ROR R21
	BRCC SKIP_MULT1
	LSL R22
SKIP_MULT1:
	ROR R21
	BRCC SKIP_MULT2
	LSL R22
	LSL R22
SKIP_MULT2:
	ROR R21
	BRCC SKIP_MULT3
	LSL R22
	LSL R22
	LSL R22
	LSL R22
SKIP_MULT3:
	COM R22
	OUT PORTD, R22
	COM R22
	RCALL DELAY2
	LSL R22
	BRCC FULL_SPIN1
	LDI R22, 0x01
FULL_SPIN1:
    COM R22
	OUT PORTD, R22
	COM R22
	RCALL DELAY2
	LSL R22
	BRCC FULL_SPIN2
	LDI R22, 0x01
FULL_SPIN2:
	COM R22
	OUT PORTD, R22
	COM R22
	RCALL DELAY2
	RCALL DELAY2
	LSL R22
	BRCC FULL_SPIN3
	LDI R22, 0x01
FULL_SPIN3:
	COM R22
	OUT PORTD, R22
	COM R22
	RCALL DELAY2
	RCALL DELAY2
	RCALL DELAY2
	LSL R22
	BRCC FULL_SPIN4
	LDI R22, 0x01
FULL_SPIN4:
    COM R22
	OUT PORTD, R22
	COM R22
	RCALL DELAY2
	RCALL DELAY2
	RCALL DELAY2
	RCALL DELAY2
	RCALL DELAY2
	RJMP START

DELAY1:
	LDI R17, 100
LOOP12:
	LDI R18, 13
LOOP11:
	DEC R18
	BRNE LOOP11
	DEC R17
	BRNE LOOP12
	RET

DELAY2:
	LDI R17, 90
LOOP23:
	LDI R18, 100
LOOP22:
	LDI R19, 100
LOOP21:
	DEC R19
	BRNE LOOP21
	DEC R18
	BRNE LOOP22
	DEC R17
	BRNE LOOP23
	RET

DELAY3:
	LDI R17, 200
LOOP33:
	LDI R18, 200
LOOP32:
	LDI R19, 200
LOOP31:
	DEC R19
	BRNE LOOP31
	DEC R18
	BRNE LOOP32
	DEC R17
	BRNE LOOP33
	RET

SEVSEG:
	CP R27, R30
	BRNE NOT_0
	CALL NUM_0
NOT_0:	INC R27
	CP R27, R30
	BRNE NOT_1
	CALL NUM_1
NOT_1:	INC R27
	CP R27, R30
	BRNE NOT_2
	CALL NUM_2
NOT_2:	INC R27
	CP R27, R30
	BRNE NOT_3
	CALL NUM_3
NOT_3:	INC R27
	CP R27, R30
	BRNE NOT_4
	CALL NUM_4
NOT_4:	INC R27
	CP R27, R30
	BRNE NOT_5
	CALL NUM_5
NOT_5:	INC R27
	CP R27, R30
	BRNE NOT_6
	CALL NUM_6
NOT_6:	INC R27
	CP R27, R30
	BRNE NOT_7
	CALL NUM_7
NOT_7:	INC R27
	CP R27, R30
	BRNE NOT_8
	CALL NUM_8
NOT_8:	INC R27
	CP R27, R30
	BRNE NOT_9
	CALL NUM_9
NOT_9:	RET		

PLAY_A_SONG:
	RCALL QUARTERE
	RCALL DELAYC
	RCALL QUARTERE
	RCALL QUARTERF
	RCALL QUARTERG
	RCALL DELAYC
	RCALL QUARTERG
	RCALL QUARTERF
	RCALL QUARTERE
	RCALL QUARTERD
	RCALL QUARTERC
	RCALL DELAYC
	RCALL QUARTERC
	RCALL QUARTERD
	RCALL QUARTERE
	RCALL DELAYC
	RCALL QUARTERE
	RCALL QUARTERD
	RCALL DELAYC
	RCALL HALFD
	RCALL LINE2_4
	RCALL QUARTERD
	RCALL DELAYC
	RCALL QUARTERD
	RCALL QUARTERE
	RCALL QUARTERC
	RCALL QUARTERD
	RCALL QUARTERF
	RCALL QUARTERE
	RCALL QUARTERC
	RCALL QUARTERD
	RCALL QUARTERF
	RCALL QUARTERE
	RCALL QUARTERD
	RCALL QUARTERC
	RCALL QUARTERD
	RCALL HALFG
	RCALL LINE2_4
	RJMP START

LINE2_4:
	RCALL QUARTERE
	RCALL DELAYC
	RCALL QUARTERE
	RCALL QUARTERF
	RCALL QUARTERG
	RCALL DELAYC
	RCALL QUARTERG
	RCALL QUARTERF
	RCALL QUARTERE
	RCALL QUARTERD
	RCALL QUARTERC
	RCALL DELAYC
	RCALL QUARTERC
	RCALL QUARTERD
	RCALL QUARTERE
	RCALL QUARTERD
	RCALL QUARTERC
	RCALL DELAYC
	RCALL HALFC
	RET

QUARTERG:
	LDI R23, 0x10
LOOP3G:
	LDI R24, 0x01
LOOP2G:
	LDI R25, 0x31
LOOP1G:
	SBI PORTE, 4
	RCALL DELAYG
	CBI PORTE, 4
	RCALL DELAYG
	DEC R25
	BRNE LOOP1G
	DEC R24
	BRNE LOOP2G
	DEC R23
	BRNE LOOP3G
	RET

DELAYG:
	LDI R17, 0x04
LOOP2Ga:
	LDI R18, 0xD3
LOOP1Ga:
	DEC R18
	BRNE LOOP1Ga
	DEC R17
	BRNE LOOP2Ga
	RET

QUARTERF:
	LDI R23, 0x10
LOOP3F:
	LDI R24, 0x01
LOOP2F:
	LDI R25, 0x31
LOOP1F:
	SBI PORTE, 4
	RCALL DELAYF
	CBI PORTE, 4
	RCALL DELAYF
	DEC R25
	BRNE LOOP1F
	DEC R24
	BRNE LOOP2F
	DEC R23
	BRNE LOOP3F
	RET

DELAYF:
	LDI R17, 0x04
LOOP2Fa:
	LDI R18, 0xED
LOOP1Fa:
	DEC R18
	BRNE LOOP1Fa
	DEC R17
	BRNE LOOP2Fa
	RET

QUARTERE:
	LDI R23, 0x10
LOOP3E:
	LDI R24, 0x01
LOOP2E:
	LDI R25, 0x31
LOOP1E:
	SBI PORTE, 4
	RCALL DELAYE
	CBI PORTE, 4
	RCALL DELAYE
	DEC R25
	BRNE LOOP1E
	DEC R24
	BRNE LOOP2E
	DEC R23
	BRNE LOOP3E
	RET

DELAYE:
	LDI R17, 0x04
LOOP2Ea:
	LDI R18, 0xFB
LOOP1Ea:
	DEC R18
	BRNE LOOP1Ea
	DEC R17
	BRNE LOOP2Ea
	RET

QUARTERD:
	LDI R23, 0x10
LOOP3D:
	LDI R24, 0x01
LOOP2D:
	LDI R25, 0x31
LOOP1D:
	SBI PORTE, 4
	RCALL DELAYD
	CBI PORTE, 4
	RCALL DELAYD
	DEC R25
	BRNE LOOP1D
	DEC R24
	BRNE LOOP2D
	DEC R23
	BRNE LOOP3D
	RET

DELAYD:
	LDI R17, 0x0D
LOOP2Da:
	LDI R18, 0x56
LOOP1Da:
	DEC R18
	BRNE LOOP1Da
	DEC R17
	BRNE LOOP2Da
	RET

QUARTERC:
	LDI R23, 0x10
LOOP3C:
	LDI R24, 0x01
LOOP2C:
	LDI R25, 0x31
LOOP1C:
	SBI PORTE, 4
	RCALL DELAYC
	CBI PORTE, 4
	RCALL DELAYC
	DEC R25
	BRNE LOOP1C
	DEC R24
	BRNE LOOP2C
	DEC R23
	BRNE LOOP3C
	RET

DELAYC:
	LDI R17, 0x09
LOOP2Ca:
	LDI R18, 0x8C
LOOP1Ca:
	DEC R18
	BRNE LOOP1Ca
	DEC R17
	BRNE LOOP2Ca
	RET

HALFG:
	LDI R23, 0x10
LOOP3GH:
	LDI R24, 0x01
LOOP2GH:
	LDI R25, 0x59
LOOP1GH:
	SBI PORTE, 4
	RCALL DELAYG
	CBI PORTE, 4
	RCALL DELAYG
	DEC R25
	BRNE LOOP1GH
	DEC R24
	BRNE LOOP2GH
	DEC R23
	BRNE LOOP3GH
	RET

HALFD:
	LDI R23, 0x10
LOOP3DH:
	LDI R24, 0x01
LOOP2DH:
	LDI R25, 0x59
LOOP1DH:
	SBI PORTE, 4
	RCALL DELAYD
	CBI PORTE, 4
	RCALL DELAYD
	DEC R25
	BRNE LOOP1DH
	DEC R24
	BRNE LOOP2DH
	DEC R23
	BRNE LOOP3DH
	RET


HALFC:
	LDI R23, 0x10
LOOP3CH:
	LDI R24, 0x01
LOOP2CH:
	LDI R25, 0x59
LOOP1CH:
	SBI PORTE, 4
	RCALL DELAYC
	CBI PORTE, 4
	RCALL DELAYC
	DEC R25
	BRNE LOOP1CH
	DEC R24
	BRNE LOOP2CH
	DEC R23
	BRNE LOOP3CH
	RET

NUM_0:	
	CBI PORTD, 0	; Turns on necessary LEDs, waits some time, then
	CBI PORTD, 1	; turns them off
	CBI PORTD, 2
	CBI PORTD, 3
	CBI PORTD, 5
	CBI PORTD, 4
	CBI PORTD, 6
	CBI PORTD, 7
	CALL DELAY3
	SBI PORTD, 0
	SBI PORTD, 1
	SBI PORTD, 2
	SBI PORTD, 3
	SBI PORTD, 5
	SBI PORTD, 4
	SBI PORTD, 6
	SBI PORTD, 7
	RET

NUM_1:	
	CBI PORTD, 3
	CBI PORTD, 6
	CBI PORTD, 7
	CALL DELAY3
	SBI PORTD, 3
	SBI PORTD, 6
	SBI PORTD, 7
	RET	

NUM_2:	
	CBI PORTD, 0
	CBI PORTD, 7
	CALL DELAY3
	SBI PORTD, 0
	SBI PORTD, 7
	RET

NUM_3:	
	CBI PORTD, 0
	CBI PORTD, 1
	CBI PORTD, 2
	CBI PORTE, 5
	CBI PORTD, 4
	CBI PORTD, 5
	CBI PORTD, 6
	CBI PORTD, 7
	CALL DELAY3
	SBI PORTD, 0
	SBI PORTD, 1
	SBI PORTD, 2
	SBI PORTE, 5
	SBI PORTD, 4
	SBI PORTD, 5
	SBI PORTD, 6
	SBI PORTD, 7
	RET

NUM_4:	
	CBI PORTD, 0
	CBI PORTD, 2
	CBI PORTD, 3
	CBI PORTE, 5
	CBI PORTD, 4
	CBI PORTD, 7
	CALL DELAY3
	SBI PORTD, 0
	SBI PORTD, 2
	SBI PORTD, 3
	SBI PORTE, 5
	SBI PORTD, 4
	SBI PORTD, 7
	RET

NUM_5:	
	CBI PORTD, 0
	CBI PORTD, 2
	CBI PORTE, 5
	CBI PORTD, 5
	CBI PORTD, 7
	CALL DELAY3
	SBI PORTD, 0
	SBI PORTD, 2
	SBI PORTE, 5
	SBI PORTD, 5
	SBI PORTD, 7
	RET

NUM_6:	
	CBI PORTD, 0
	CBI PORTD, 2
	CBI PORTD, 3
	CBI PORTD, 4
	CBI PORTD, 5
	CBI PORTD, 7
	CALL DELAY3
	SBI PORTD, 0
	SBI PORTD, 2
	SBI PORTD, 3
	SBI PORTD, 4
	SBI PORTD, 5
	SBI PORTD, 7
	RET

NUM_7:	
	CBI PORTD, 0
	CBI PORTD, 1
	CBI PORTD, 2
	CBI PORTD, 4
	CBI PORTD, 7
	CALL DELAY3
	SBI PORTD, 0
	SBI PORTD, 1
	SBI PORTD, 2
	SBI PORTD, 4
	SBI PORTD, 7
	RET

NUM_8:	
	CBI PORTD, 0
	CBI PORTD, 1
	CBI PORTD, 2
	CBI PORTD, 3
	CBI PORTE, 5
	CBI PORTD, 4
	CBI PORTD, 5
	CBI PORTD, 6
	CBI PORTD, 7
	CALL DELAY3
	SBI PORTD, 0
	SBI PORTD, 1
	SBI PORTD, 2
	SBI PORTD, 3
	SBI PORTE, 5
	SBI PORTD, 4
	SBI PORTD, 5
	SBI PORTD, 6
	SBI PORTD, 7
	RET

NUM_9:
	CBI PORTD, 1
	CBI PORTD, 2
	CBI PORTE, 5
	CBI PORTD, 4
	CBI PORTD, 7
	CALL DELAY3
	SBI PORTD, 1
	SBI PORTD, 2
	SBI PORTE, 5
	SBI PORTD, 4
	SBI PORTD, 7
	RET

	TIMERDELAY:
	LDI R23, 132
LOOPT3:
	LDI R24, 200
LOOPT2:
	LDI R25, 201
LOOPT1:
	DEC R25
	BRNE LOOPT1
	DEC R24
	BRNE LOOPT2
	DEC R23
	BRNE LOOPT3
	RET

STOPWATCH_PRESS:
	SBIC PINA, 6
	RJMP STOPWATCH
	RJMP STOPWATCH_PRESS



